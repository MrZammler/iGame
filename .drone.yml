---
kind: pipeline
type: docker
name: compile-iGame

steps:
- name: compile-m68k-000
  pull: always
  image: walkero/docker4amigavbcc:latest-m68k
  commands:
    - cd /drone/src
    - make -f Makefile.docker
- name: compile-m68k-030
  image: walkero/docker4amigavbcc:latest-m68k
  commands:
    - cd /drone/src
    - make -f Makefile.docker iGame.030
- name: compile-m68k-040
  image: walkero/docker4amigavbcc:latest-m68k
  commands:
    - cd /drone/src
    - make -f Makefile.docker iGame.040
- name: compile-m68k-060
  image: walkero/docker4amigavbcc:latest-m68k
  commands:
    - cd /drone/src
    - make -f Makefile.docker iGame.060
- name: compile-os4
  pull: always
  image: walkero/docker4amigavbcc:latest-ppc
  commands:
    - cd /drone/src
    - make -f Makefile.docker iGame.OS4
- name: create-nightly-package
  pull: always
  image: walkero/docker4amigavbcc:latest-m68k
  commands:
    - cd /drone/src
    - make -f Makefile.docker nightly
- name: deploy-all-binary
  pull: always
  image: plugins/github-release
  settings:
    api_key:
      from_secret: GITHUB_RELEASE_API_KEY
    files:
      - "iGame-nightly-*.lha"
    title: "iGame-nighty ${DATE}"
- name: clean-nightly-package
  pull: always
  image: walkero/docker4amigavbcc:latest-m68k
  commands:
    - cd /drone/src
    - make -f Makefile.docker clean-nightly

trigger:
  branch:
    include:
      - nightly-release
  event:
    include:
      - push
